<!DOCTYPE html>
<html lang="fr">
<head>
  <meta charset="UTF-8" />
  <title>CalendArq - Calendrier de l'Avent Twitch</title>
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <style>
  :root {
    --bg: #050816;
    --bg-card: #111827;
    --bg-card-open: #1f2937;
    --accent: #8b5cf6;
    --accent-soft: rgba(139, 92, 246, 0.18);
    --text: #f9fafb;
    --muted: #d1d5db;
    --border: #1f2937;
    --shadow-soft: 0 18px 40px rgba(0, 0, 0, 0.45);
    --radius-lg: 1.2rem;
    --transition-fast: 180ms ease-out;
    --transition-slow: 240ms ease-out;
    --font-main: system-ui, -apple-system, BlinkMacSystemFont, "Segoe UI",
      sans-serif;
  }

  * {
    box-sizing: border-box;
  }

  body {
    margin: 0;
    min-height: 100vh;
    font-family: var(--font-main);
    background:
      radial-gradient(circle at top left, #1e293b 0, transparent 55%),
      radial-gradient(circle at top right, #0f172a 0, transparent 55%),
      radial-gradient(circle at bottom, #020617 0, #000 65%);
    color: var(--text);
    display: flex;
    flex-direction: column;
    align-items: center;
    padding: 1.5rem;
    position: relative;
  }

  .app {
    width: 100%;
    max-width: 1100px;
    margin: auto;
    background: linear-gradient(135deg, rgba(15, 23, 42, 0.96), rgba(15, 23, 42, 0.88));
    border-radius: 1.5rem;
    border: 1px solid rgba(148, 163, 184, 0.2);
    box-shadow: var(--shadow-soft);
    padding: 1.5rem 1.8rem 2.2rem;
    backdrop-filter: blur(18px);
    position: relative;
    z-index: 1;
  }
  
  .bg-tree {
    position: absolute;
    z-index: 0;
    pointer-events: none;
    opacity: 0.75;
    filter: drop-shadow(0 0 6px rgba(139,92,246,0.8));
    transform-origin: center;
  }

  .bg-tree.secret-tree {
    pointer-events: auto;
    cursor: pointer;
  }
  
  header {
    display: flex;
    flex-direction: column;
    align-items: center;
    text-align: center;
    gap: 1rem;
    margin-bottom: 1.5rem;
  }

  .title-block {
    display: flex;
    flex-direction: column;
    gap: 0.3rem;
  }

  .header-center {
    display: flex;
    flex-direction: column;
    align-items: center;
    text-align: center;
    max-width: 850px;
    margin: 0 auto;
  }

  .description-block {
    margin-top: 0.6rem;
    font-size: 0.95rem;
    color: var(--muted);
    line-height: 1.5;
  }

  .description-block .important-note {
    color: var(--text);
  }

  .logo-row {
    display: inline-flex;
    align-items: center;
    gap: 0.6rem;
  }

  .logo-img {
    height: 52px;
    width: auto;
    display: block;
    object-fit: contain;
  }

  h1 {
    font-size: clamp(1.7rem, 2.5vw, 2.1rem);
    margin: 0;
    letter-spacing: 0.02em;
    display: flex;
    align-items: center;
    gap: 0.4rem;
  }

  h1 span.highlight {
    color: var(--accent);
  }

  .info-box {
    min-width: 220px;
    background: rgba(15, 23, 42, 0.9);
    border-radius: 1rem;
    border: 1px solid rgba(148, 163, 184, 0.35);
    padding: 0.9rem 1rem;
    font-size: 0.85rem;
    color: var(--muted);
    display: flex;
    flex-direction: column;
    gap: 0.25rem;
  }

  .info-wrapper {
    display: flex;
    gap: 1.2rem;
    flex-wrap: wrap;
    justify-content: center;
    margin-top: 1.2rem;
    width: 100%;
  }

  .info-wrapper .info-box {
    flex: 1 1 300px;
    max-width: 380px;
  }
  
  .info-label {
    text-transform: uppercase;
    letter-spacing: 0.12em;
    font-size: 0.75rem;
    color: var(--accent);
    margin-bottom: 0.35rem;
  }

  .info-explanation .info-text,
  .info-lottery .info-text {
    font-size: 0.9rem;
    color: var(--muted);
    line-height: 1.4;
  }

  main {
    display: flex;
    flex-direction: column;
    gap: 1rem;
  }

  .calendar-header {
    display: flex;
    justify-content: space-between;
    align-items: center;
    gap: 0.75rem;
    margin-top: 0.5rem;
    margin-bottom: 0.25rem;
    flex-wrap: wrap;
  }

  .calendar-header-title {
    font-size: 1rem;
    font-weight: 500;
    display: flex;
    align-items: center;
    gap: 0.4rem;
  }

  .calendar-header-badge {
    font-size: 0.8rem;
    padding: 0.25rem 0.55rem;
    border-radius: 999px;
    background: var(--accent-soft);
    color: var(--accent);
    border: 1px solid rgba(139, 92, 246, 0.6);
  }

  .legend {
    display: flex;
    flex-wrap: wrap;
    gap: 0.5rem;
    font-size: 0.8rem;
    color: var(--muted);
    align-items: center;
  }

  .legend-item {
    display: inline-flex;
    align-items: center;
    gap: 0.3rem;
  }

  .legend-dot {
    width: 10px;
    height: 10px;
    border-radius: 999px;
    background: rgba(148,163,184,0.9);
    border: none;
  }

  .legend-dot.special {
    background: var(--accent-soft);
  }

  .legend-dot.opened {
    background: #22c55e;
    box-shadow: none;
  }

  .calendar {
    margin-top: 0.5rem;
    display: grid;
    grid-template-columns: repeat(auto-fit, minmax(120px, 1fr));
    gap: 0.9rem;
  }

  .day-card {
    position: relative;
    background: radial-gradient(circle at 20% 0%, #111827 0, var(--bg-card) 55%);
    border-radius: var(--radius-lg);
    padding: 0.9rem 0.9rem 0.8rem;
    border: 1px solid rgba(75, 85, 99, 0.7);
    cursor: pointer;
    transition: transform var(--transition-fast),
                box-shadow var(--transition-fast),
                border-color var(--transition-fast),
                background var(--transition-slow);
    display: flex;
    flex-direction: column;
    align-items: flex-start;
    justify-content: space-between;
    min-height: 110px;
    overflow: hidden;
    color: var(--text);
  }

  .day-card::before {
    content: "";
    position: absolute;
    inset: 0;
    background: radial-gradient(circle at 0 0, rgba(139, 92, 246, 0.35), transparent 55%);
    opacity: 0;
    transition: opacity var(--transition-slow);
    pointer-events: none;
  }

  .day-card:hover {
    transform: translateY(-3px);
    box-shadow: 0 12px 30px rgba(0, 0, 0, 0.45);
    border-color: rgba(139, 92, 246, 0.8);
  }

  .day-card:hover::before {
    opacity: 1;
  }

  .day-card.opened {
    background: #312e81;
    border-color: rgba(191, 219, 254, 0.9);
    transform: translateY(-1px);
  }

  .day-card.opened::before {
    opacity: 0;
  }

  .day-card.locked {
    cursor: not-allowed;
    opacity: 0.6;
    border-style: dashed;
  }

  .day-card.locked:hover {
    transform: none;
    box-shadow: none;
    border-color: rgba(148,163,184,0.5);
  }

  .day-label-row {
    display: flex;
    align-items: center;
    justify-content: space-between;
    width: 100%;
    margin-bottom: 0.4rem;
  }

  .day-number {
    font-size: 1.25rem;
    font-weight: 700;
    color: var(--text);
  }

  .day-tag {
    font-size: 0.7rem;
    text-transform: uppercase;
    letter-spacing: 0.15em;
    padding: 0.18rem 0.4rem;
    border-radius: 999px;
    border: 1px solid rgba(148, 163, 184, 0.6);
    color: var(--muted);
    background: rgba(15, 23, 42, 0.9);
  }

  .day-card.special .day-tag {
    border-color: rgba(139, 92, 246, 0.9);
    color: var(--accent);
    background: var(--accent-soft);
  }

  .day-title {
    font-size: 0.9rem;
    font-weight: 500;
    margin-bottom: 0.15rem;
    text-align: left;
    color: var(--text);
  }

  .day-footer {
    margin-top: 0.45rem;
    font-size: 0.77rem;
    color: var(--muted);
    display: flex;
    align-items: center;
    gap: 0.3rem;
  }

  .dot-pill {
    width: 6px;
    height: 6px;
    border-radius: 999px;
    background: rgba(148, 163, 184, 0.9);
  }

  .day-card.special .dot-pill {
    background: var(--accent);
  }

  .day-card.opened .dot-pill {
    background: #22c55e;
  }

  .modal-backdrop {
    position: fixed;
    inset: 0;
    background: rgba(15, 23, 42, 0.97);
    display: none;
    justify-content: center;
    align-items: center;
    padding: 1.2rem;
    z-index: 50;
  }

  .modal-backdrop.visible {
    display: flex;
  }

  .modal {
    width: 100%;
    max-width: 500px;
    background: radial-gradient(circle at 0 0, rgba(139, 92, 246, 0.12), #020617);
    border-radius: 1.3rem;
    border: 1px solid rgba(148, 163, 184, 0.4);
    padding: 1.4rem 1.4rem 1.1rem;
    box-shadow: 0 22px 48px rgba(0, 0, 0, 0.7);
    position: relative;
    color: var(--text);
  }

  .modal-header {
    display: flex;
    align-items: flex-start;
    justify-content: space-between;
    gap: 1rem;
    margin-bottom: 0.7rem;
  }

  .modal-title-block {
    display: flex;
    flex-direction: column;
    gap: 0.1rem;
  }

  .modal-day-label {
    font-size: 0.8rem;
    text-transform: uppercase;
    letter-spacing: 0.14em;
    color: var(--muted);
  }

  .modal-title {
    font-size: 1.2rem;
    font-weight: 600;
    color: var(--text);
  }

  .modal-tag {
    font-size: 0.75rem;
    padding: 0.2rem 0.55rem;
    border-radius: 999px;
    border: 1px solid rgba(148, 163, 184, 0.7);
    color: var(--muted);
    align-self: flex-start;
    background: rgba(15, 23, 42, 0.9);
  }

  .modal-tag.special {
    border-color: rgba(139, 92, 246, 0.9);
    color: var(--accent);
    background: var(--accent-soft);
  }

  .modal-close {
    position: absolute;
    right: 0.7rem;
    top: 0.6rem;
    border: none;
    background: transparent;
    color: var(--muted);
    font-size: 1.1rem;
    cursor: pointer;
    padding: 0.25rem;
    border-radius: 999px;
    transition: background var(--transition-fast), color var(--transition-fast);
  }

  .modal-close:hover {
    background: rgba(15, 23, 42, 0.9);
    color: var(--text);
  }

  .modal-body {
    font-size: 0.9rem;
    color: var(--muted);
    line-height: 1.5;
    margin-bottom: 0.9rem;
  }

  .modal-body strong {
    color: var(--text);
    font-weight: 600;
  }

  .modal-footer {
    display: flex;
    justify-content: space-between;
    align-items: center;
    gap: 0.7rem;
    flex-wrap: wrap;
  }

  .btn-primary {
    border: none;
    border-radius: 999px;
    padding: 0.45rem 0.9rem;
    font-size: 0.85rem;
    font-weight: 500;
    cursor: pointer;
    background: linear-gradient(135deg, #8b5cf6, #ec4899);
    color: #f9fafb;
    display: inline-flex;
    align-items: center;
    gap: 0.35rem;
    box-shadow: 0 12px 25px rgba(0, 0, 0, 0.45);
    text-decoration: none;
  }

  .btn-primary:hover {
    filter: brightness(1.05);
    transform: translateY(-1px);
  }

  .modal-hint {
    font-size: 0.78rem;
    color: var(--muted);
  }

  footer.app-footer {
    margin-top: 1.2rem;
    font-size: 0.75rem;
    color: #6b7280;
    text-align: right;
  }

  footer.app-footer a {
    color: var(--accent);
    text-decoration: none;
  }

  footer.app-footer a:hover {
    text-decoration: underline;
  }

  .reset-btn {
    margin-top: 1.5rem;
    background: #b91c1c;
    color: white;
    border: none;
    padding: 0.6rem 1.2rem;
    font-size: 0.9rem;
    cursor: pointer;
    border-radius: 8px;
    transition: 0.2s;
  }

  .reset-btn:hover {
    background: #dc2626;
    transform: scale(1.03);
  }

  @media (max-width: 600px) {
    .app {
      padding: 1.15rem 1rem 1.6rem;
    }

    .calendar-header {
      flex-direction: column;
      align-items: flex-start;
    }

    .day-card {
      min-height: 105px;
    }
  }
  </style>
</head>
<body>
  <div class="app">
    <header>
      <div class="header-center">
        <div class="title-block">
          <div class="logo-row">
            <img src="logo-arq.png" alt="Logo Arqueftx" class="logo-img" />
            <h1>
              Calend<span class="highlight">Arq</span>
            </h1>
          </div>
        </div>
        <div class="description-block">
          Calendrier de l'Avent sp√©cial Twitch : chaque jour, d√©couvre en cliquant sur la case le jeu qui sera stream√© en live.
          Le 24, un tirage au sort permettra √† un¬∑e follower de gagner un jeu d‚Äôune valeur d‚Äôenviron 50‚Ç¨ üéÅ
          <br>
          <span class="important-note">√âtrange cette odeur de sapin.</span>
        </div>
      </div>

      <div class="info-wrapper">
        <div class="info-box info-explanation">
          <div class="info-label">Comment √ßa marche ?</div>
          <div class="info-text">
            Clique chaque jour sur la case correspondante pour d√©couvrir le jeu (ou la surprise) du calendrier.
          </div>
        </div>

        <div class="info-box info-lottery">
          <div class="info-label">Tirage au sort du 24</div>
          <div class="info-text">
            Pour participer, il suffit d‚Äôutiliser une fois le Power-Up d√©di√© (<strong>20 000 points de cha√Æne</strong>).
            Une seule utilisation suffit : l‚Äôactiver plusieurs fois ne donne pas plus de chances.
          </div>
        </div>
      </div>
    </header>

    <main>
      <div class="calendar-header">
        <div class="calendar-header-title">
          Calendrier de l'Avent
          <span class="calendar-header-badge">1 ‚Üí 24 d√©cembre</span>
        </div>
        <div class="legend">
          <div class="legend-item">
            <span class="legend-dot"></span> Case ferm√©e
          </div>
          <div class="legend-item">
            <span class="legend-dot special"></span> Case sp√©ciale (24&nbsp;: tirage au sort)
          </div>
          <div class="legend-item">
            <span class="legend-dot opened"></span> Case d√©j√† ouverte
          </div>
        </div>
      </div>

      <section id="calendar" class="calendar" aria-label="Calendrier de l'Avent">
      </section>
    </main>

    <footer class="app-footer">
      CalendArq ‚Äì calendrier de l'Avent pour streams Twitch. <span>v1.2.0</span>
    </footer>
    <button id="resetCalendar" class="reset-btn">üî¥ R√©initialiser les cases</button>
  </div>
  <div class="modal-backdrop" id="modal-backdrop" aria-hidden="true">
    <div class="modal" role="dialog" aria-modal="true" aria-labelledby="modal-title">
      <button class="modal-close" id="modal-close" aria-label="Fermer la fen√™tre">
        ‚úï
      </button>
      <div class="modal-header">
        <div class="modal-title-block">
          <div class="modal-day-label" id="modal-day-label"></div>
          <div class="modal-title" id="modal-title"></div>
        </div>
        <div class="modal-tag" id="modal-tag"></div>
      </div>
      <div class="modal-body" id="modal-body"></div>
      <div class="modal-footer">
        <a id="modal-twitch-btn" class="btn-primary" href="#" target="_blank" rel="noopener noreferrer">
          Voir le stream sur Twitch
        </a>
        <div class="modal-hint" id="modal-hint"></div>
      </div>
    </div>
  </div>

  <script>
    const calendarConfig = [
      {
        day: 1,
        title: "Valiant Hearts: The Great War",
        description:
          "Soldats Inconnus : M√©moires de la Grande Guerre‚Ñ¢ est un jeu d‚Äôaventure narratif qui suit le destin crois√© de plusieurs personnages pendant la Premi√®re Guerre mondiale. " +
          "Entre √©nigmes, infiltration et moments d‚Äô√©motion, le jeu met l‚Äôaccent sur les histoires humaines plut√¥t que sur l‚Äôaction pure.",
        twitchUrl: "https://www.twitch.tv/arqueftx"
      },
      {
        day: 2,
        title: "Bad North: Jotunn Edition",
        description:
          "Un jeu tactique o√π tu dois d√©fendre tes petites √Æles contre des invasions vikings ! " +
          "D√©place tes troupes, anticipe les vagues ennemies et prot√®ge les maisons pour obtenir des ressources. " +
          "La Jotunn Edition ajoute de nouveaux traits, des ennemis vari√©s et une difficult√© relev√©e pour des combats encore plus intenses.",
        twitchUrl: "https://www.twitch.tv/arqueftx"
      },
      {
        day: 3,
        title: "Final Fantasy IX",
        description:
          "JE D√âCOUVRE ENFIN FINAL FANTASY IX AVEC ENTHOUSIASME ET BONHEUR !!! NIKO, L√ÇCHE CE FLINGUE MAINTENANT<br><br>" +
          "Je peux m√™me pas vous dire ce que c'est, j'y connais rien et j'ai pas envie alors venez tous le voir en stream !<br><br>" +
          "Askip, c'est un jeu de foot y a Zidane dedans",
        twitchUrl: "https://www.twitch.tv/arqueftx"
      },
      {
        day: 4,
        title: "Jeu du 4 d√©cembre",
        description: "Jeu √† d√©finir.",
        twitchUrl: "https://www.twitch.tv/arqueftx"
      },
      {
        day: 5,
        title: "Jeu du 5 d√©cembre",
        description: "Jeu √† d√©finir.",
        twitchUrl: "https://www.twitch.tv/arqueftx"
      },
      {
        day: 6,
        title: "Jeu du 6 d√©cembre",
        description: "Jeu √† d√©finir.",
        twitchUrl: "https://www.twitch.tv/arqueftx"
      },
      {
        day: 7,
        title: "Jeu du 7 d√©cembre",
        description: "Jeu √† d√©finir.",
        twitchUrl: "https://www.twitch.tv/arqueftx"
      },
      {
        day: 8,
        title: "Jeu du 8 d√©cembre",
        description: "Jeu √† d√©finir.",
        twitchUrl: "https://www.twitch.tv/arqueftx"
      },
      {
        day: 9,
        title: "Jeu du 9 d√©cembre",
        description: "Jeu √† d√©finir.",
        twitchUrl: "https://www.twitch.tv/arqueftx"
      },
      {
        day: 10,
        title: "Jeu du 10 d√©cembre",
        description: "Jeu √† d√©finir.",
        twitchUrl: "https://www.twitch.tv/arqueftx"
      },
      {
        day: 11,
        title: "Jeu du 11 d√©cembre",
        description: "Jeu √† d√©finir.",
        twitchUrl: "https://www.twitch.tv/arqueftx"
      },
      {
        day: 12,
        title: "Jeu du 12 d√©cembre",
        description: "Jeu √† d√©finir.",
        twitchUrl: "https://www.twitch.tv/arqueftx"
      },
      {
        day: 13,
        title: "Jeu du 13 d√©cembre",
        description: "Jeu √† d√©finir.",
        twitchUrl: "https://www.twitch.tv/arqueftx"
      },
      {
        day: 14,
        title: "Jeu du 14 d√©cembre",
        description: "Jeu √† d√©finir.",
        twitchUrl: "https://www.twitch.tv/arqueftx"
      },
      {
        day: 15,
        title: "Jeu du 15 d√©cembre",
        description: "Jeu √† d√©finir.",
        twitchUrl: "https://www.twitch.tv/arqueftx"
      },
      {
        day: 16,
        title: "Jeu du 16 d√©cembre",
        description: "Jeu √† d√©finir.",
        twitchUrl: "https://www.twitch.tv/arqueftx"
      },
      {
        day: 17,
        title: "Jeu du 17 d√©cembre",
        description: "Jeu √† d√©finir.",
        twitchUrl: "https://www.twitch.tv/arqueftx"
      },
      {
        day: 18,
        title: "Jeu du 18 d√©cembre",
        description: "Jeu √† d√©finir.",
        twitchUrl: "https://www.twitch.tv/arqueftx"
      },
      {
        day: 19,
        title: "Jeu du 19 d√©cembre",
        description: "Jeu √† d√©finir.",
        twitchUrl: "https://www.twitch.tv/arqueftx"
      },
      {
        day: 20,
        title: "Jeu du 20 d√©cembre",
        description: "Jeu √† d√©finir.",
        twitchUrl: "https://www.twitch.tv/arqueftx"
      },
      {
        day: 21,
        title: "Jeu du 21 d√©cembre",
        description: "Jeu √† d√©finir.",
        twitchUrl: "https://www.twitch.tv/arqueftx"
      },
      {
        day: 22,
        title: "Jeu du 22 d√©cembre",
        description: "Jeu √† d√©finir.",
        twitchUrl: "https://www.twitch.tv/arqueftx"
      },
      {
        day: 23,
        title: "Jeu du 23 d√©cembre",
        description: "Jeu √† d√©finir.",
        twitchUrl: "https://www.twitch.tv/arqueftx"
      },
      {
        day: 24,
        title: "Case finale : Tirage au sort üéÅ",
        description:
          "Le 24 d√©cembre, ce ne sera pas un stream classique : ce sera le TAS d'un jeu d'une valeur d'environ 50 ‚Ç¨ " +
          "offert pour les followers !\n\nReste connect√©¬∑e au live pour d√©couvrir le jeu en question et comment " +
          "tenter ta chance.",
        twitchUrl: "https://www.twitch.tv/arqueftx",
        special: true
      }
    ];

    const today = new Date();
    let currentDay;

    if (today.getMonth() === 11) {
      currentDay = Math.min(today.getDate(), 24);
    } else {
      currentDay = 24;
    }

    const calendarEl = document.getElementById("calendar");
    const openedClass = "opened";
    const STORAGE_KEY = "CalendArq_opened_days";
    const SECRET_KEY = "CalendArq_secret_found";
    
    function loadOpenedDays() {
      try {
        const raw = localStorage.getItem(STORAGE_KEY);
        if (!raw) return [];
        const parsed = JSON.parse(raw);
        if (!Array.isArray(parsed)) return [];
        return parsed.filter((d) => typeof d === "number" && d <= currentDay);
      } catch (e) {
        return [];
      }
    }

    function saveOpenedDays(days) {
      try {
        localStorage.setItem(STORAGE_KEY, JSON.stringify(days));
      } catch (e) {}
    }

    let openedDays = loadOpenedDays();

    function createDayCard(entry) {
      const isSpecial = Boolean(entry.special);
      const isLocked = entry.day > currentDay;
      const isRevealed = !isLocked && openedDays.includes(entry.day);
      const displayTitle = isSpecial
        ? entry.title
        : (isRevealed ? entry.title : "Jeu cach√©");

      const card = document.createElement("button");
      card.className =
        "day-card" +
        (isSpecial ? " special" : "") +
        (isLocked ? " locked" : "");
      card.type = "button";
      card.setAttribute("data-day", entry.day);

      card.innerHTML = `
        <div class="day-label-row">
          <div class="day-number">${formatDate(entry.day)}</div>
          <div class="day-tag">${isSpecial ? "Sp√©cial" : "Jeu vid√©o"}</div>
        </div>
        <div class="day-title">${displayTitle}</div>
        <div class="day-footer">
          <span class="dot-pill"></span>
        </div>
      `;

      if (isLocked) {
        card.title = `Cette case sera disponible le ${entry.day} d√©cembre.`;
      }

      if (!isLocked && openedDays.includes(entry.day)) {
        card.classList.add(openedClass);
      }

      card.addEventListener("click", () => {
        if (isLocked) return;

        if (!openedDays.includes(entry.day)) {
          openedDays.push(entry.day);
          saveOpenedDays(openedDays);
        }

        card.classList.add(openedClass);
        openModal(entry);
        const titleEl = card.querySelector(".day-title");
        if (titleEl && !isSpecial) {
          titleEl.textContent = entry.title;
        }
      });

      return card;
    }

    function formatDate(day) {
      if (day === 1) return "1er d√©c.";
      return `${day} d√©c.`;
    }
    
    function buildCalendar() {
      calendarEl.innerHTML = "";
      calendarConfig.forEach((entry) => {
        const card = createDayCard(entry);
        calendarEl.appendChild(card);
      });
    }

    const modalBackdrop = document.getElementById("modal-backdrop");
    const modalClose = document.getElementById("modal-close");
    const modalTitleEl = document.getElementById("modal-title");
    const modalDayLabelEl = document.getElementById("modal-day-label");
    const modalTagEl = document.getElementById("modal-tag");
    const modalBodyEl = document.getElementById("modal-body");
    const modalHintEl = document.getElementById("modal-hint");
    const modalTwitchBtn = document.getElementById("modal-twitch-btn");

    function openModal(entry) {
      const isSpecial = Boolean(entry.special);

      modalDayLabelEl.textContent = `Case du ${entry.day} d√©cembre`;
      modalTitleEl.textContent = entry.title;
      modalTagEl.textContent = isSpecial ? "Tirage au sort" : "Jeu du stream";
      modalTagEl.classList.toggle("special", isSpecial);

      modalBodyEl.innerHTML = (entry.description || "Informations √† venir.")
        .replace(/\n/g, "<br>");

      modalTwitchBtn.href = entry.twitchUrl || "#";
      modalTwitchBtn.style.display = entry.twitchUrl ? "inline-flex" : "none";

      modalHintEl.textContent = isSpecial
        ? "R√©serve cette case pour un moment fort avec la communaut√©. üéÑ"
        : "Le jeu pr√©vu peut exceptionnellement changer jusqu'au lancement du live (impr√©vu, souci technique...). Tu peux revenir v√©rifier ici avant le stream pour voir si le jeu est toujours le m√™me.";

      modalBackdrop.classList.add("visible");
      modalBackdrop.setAttribute("aria-hidden", "false");
    }

    function openSecretPopup() {
      modalDayLabelEl.textContent = "Sapin secret üéÑ";
      modalTitleEl.textContent = "F√©licitations !";
      modalTagEl.textContent = "Bonus cach√©";
      modalTagEl.classList.add("special");

      modalBodyEl.innerHTML = `
        Tu viens de cliquer sur <strong>le sapin cach√©</strong> de CalendArq&nbsp;! üéÑ<br><br>
        Le premier viewer qui m‚Äôenvoie un message priv√© sur Discord avec le code suivant :<br><br>
        <strong style="font-size: 1.3rem;">SP09</strong><br><br>
        (ou une capture d'√©cran de cette fen√™tre)<br><br>
        remportera <strong>un jeu d‚Äôune valeur de 20‚Ç¨</strong>.<br><br>
        D√©p√™che-toi, seul le plus rapide gagne !
      `;

      modalTwitchBtn.href = "#";
      modalTwitchBtn.style.display = "none";
      modalHintEl.textContent = "";

      modalBackdrop.classList.add("visible");
      modalBackdrop.setAttribute("aria-hidden", "false");
    }
    
    function closeModal() {
      modalBackdrop.classList.remove("visible");
      modalBackdrop.setAttribute("aria-hidden", "true");
    }

    modalClose.addEventListener("click", closeModal);

    modalBackdrop.addEventListener("click", (event) => {
      if (event.target === modalBackdrop) {
        closeModal();
      }
    });

    document.addEventListener("keydown", (event) => {
      if (event.key === "Escape") {
        closeModal();
      }
    });

    function generateBackgroundTrees() {
      const treeCount = 26;
      const docHeight = Math.max(
        document.body.scrollHeight,
        document.documentElement.scrollHeight
      );

      const trees = [];

      for (let i = 0; i < treeCount; i++) {
        const tree = document.createElement("div");
        tree.className = "bg-tree";
        tree.textContent = "üéÑ";

        const size = 22 + Math.random() * 30;
        const rotation = -25 + Math.random() * 50;
        const top = Math.random() * (docHeight - 100);

        const side = Math.random() < 0.5 ? "left" : "right";
        const horizontalOffset = Math.random() * 8;

        tree.style.fontSize = size + "px";
        tree.style.top = top + "px";
        tree.style.transform = `rotate(${rotation}deg)`;

        if (side === "left") {
          tree.style.left = horizontalOffset + "vw";
        } else {
          tree.style.right = horizontalOffset + "vw";
        }

        document.body.appendChild(tree);
        trees.push(tree);
      }

      if (trees.length > 0) {
        const secretIndex = Math.floor(Math.random() * trees.length);
        const secretTree = trees[secretIndex];

        secretTree.classList.add("secret-tree");

        secretTree.addEventListener("click", () => {
          try {
            localStorage.setItem(SECRET_KEY, "1");
          } catch (e) {}
          openSecretPopup();
        });
      }
    }
    
    buildCalendar();
    generateBackgroundTrees();

    document.getElementById("resetCalendar").addEventListener("click", () => {
      if (confirm("‚ö†Ô∏è Voulez-vous vraiment r√©initialiser toutes les cases ?")) {
        localStorage.removeItem("CalendArq_opened_days");
        location.reload();
      }
    });
  </script>
</body>
</html>
